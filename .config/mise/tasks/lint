#!/usr/bin/env bash
set -euo pipefail

#MISE description="Lint and format the codebase"

AUTOCORRECT=false
if [ "${1:-}" = "-a" ] || [ "${1:-}" = "--autocorrect" ]; then
  AUTOCORRECT=true
fi

if [ "$AUTOCORRECT" = true ]; then
  echo "Autocorrecting..."
  echo " → ruby with rubocop"
  bin/rubocop -A

  echo " → erb with erb_lint"
  bundle exec erb_lint --lint-all --autocorrect

  echo " → everything else with prettier"
  npm run format
else
  echo "Checking..."
  echo " → ruby with rubocop"
  bin/rubocop

  echo " → erb with erb_lint"
  bundle exec erb_lint --lint-all

  echo " → everything else with prettier"
  npm run format:check
fi

echo ""
echo "✨ Lint complete!"
