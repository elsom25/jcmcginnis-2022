<% is_home = page.relative_url == "/" %>
<header class="sticky top-0 z-50 w-full backdrop-blur-md bg-bg-light/95 dark:bg-bg-dark/95 border-b border-stone-200/50 dark:border-stone-800/50">
  <%= render "container" do %>
    <div class="flex items-center justify-between h-14">
      <a href="/" class="group flex items-center gap-2" aria-label="Home">
        <span class="text-brand-500 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="w-5 h-5 fill-current" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
          </svg>
        </span>
        <span class="relative">
          <span class="font-semibold text-sm <%= is_home ? 'text-stone-900 dark:text-stone-100' : 'text-stone-600 dark:text-stone-400' %> group-hover:text-stone-900 dark:group-hover:text-stone-100 transition-colors">Jesse McGinnis</span>
          <span class="absolute -bottom-1 left-0 right-0 h-[2px] bg-brand-500 rounded-full transition-transform origin-left <%= is_home ? 'scale-x-100' : 'scale-x-0 group-hover:scale-x-100' %>"></span>
        </span>
      </a>

      <%= render "header/desktop_nav", menu: menu, page: page %>
      <%= render "header/mobile_nav" %>
    </div>
  <% end %>

  <%= render "header/mobile_drawer", menu: menu, page: page %>

  <script>
    (function() {
      // Theme toggle - uses global Theme module from base layout
      const buttons = document.querySelectorAll('.theme-btn');
      const updateButtons = () => {
        const current = Theme.get();
        buttons.forEach(btn => { btn.dataset.active = btn.dataset.theme === current; });
      };
      buttons.forEach(btn => {
        btn.addEventListener('click', () => { Theme.set(btn.dataset.theme); updateButtons(); });
      });
      updateButtons();

      // Mobile menu
      const menuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      const hamburgerIcon = menuBtn.querySelector('.hamburger-icon');
      const closeIcon = menuBtn.querySelector('.close-icon');

      const openMenu = () => {
        mobileMenu.classList.remove('hidden');
        mobileMenu.offsetHeight; // Force reflow
        mobileMenu.classList.add('drawer-open');
        mobileMenu.setAttribute('aria-hidden', 'false');
        menuBtn.setAttribute('aria-expanded', 'true');
        hamburgerIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
        document.body.classList.add('mobile-menu-open');
      };

      const closeMenu = () => {
        mobileMenu.classList.remove('drawer-open');
        mobileMenu.setAttribute('aria-hidden', 'true');
        menuBtn.setAttribute('aria-expanded', 'false');
        hamburgerIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        document.body.classList.remove('mobile-menu-open');
        setTimeout(() => {
          if (!mobileMenu.classList.contains('drawer-open')) mobileMenu.classList.add('hidden');
        }, 200);
      };

      menuBtn.addEventListener('click', () => {
        mobileMenu.classList.contains('drawer-open') ? closeMenu() : openMenu();
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && mobileMenu.classList.contains('drawer-open')) closeMenu();
      });

      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', closeMenu);
      });

      window.matchMedia('(min-width: 768px)').addEventListener('change', (e) => {
        if (e.matches && mobileMenu.classList.contains('drawer-open')) closeMenu();
      });
    })();
  </script>
</header>
